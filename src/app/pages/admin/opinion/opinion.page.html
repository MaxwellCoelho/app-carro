<ion-content #IonContent [fullscreen]="true" [scrollEvents]="true">
  <app-loader [showLoader]="showLoader"></app-loader>

  <div class="main-container">
    <ion-title size="large" color="primary" class="main-title">
      <ion-icon [routerLink]="'/' + nav.admin.route" [name]="'arrow-back'" color="secondary" style="cursor: pointer"></ion-icon>
      <ion-label [routerLink]="'/' + nav.admin.route" style="cursor: pointer">{{nav.admin.title}}</ion-label>

      <ion-label>
        <ion-icon [name]="'chevron-forward'" size="small" color="medium"></ion-icon>
      </ion-label>

      <ion-icon [name]="'reader-outline'" color="secondary"></ion-icon>
      <ion-label>Opiniões</ion-label>
    </ion-title>

    <div class="main-body">
      <ion-grid slot="content">
        <ion-row [ngClass]="{'grid-content-edit': formOpinions.value.editOpinionId }">
          <ion-col>
            <h1 *ngIf="!formOpinions.value.editOpinionId">Criar nova opinião:</h1>
            <h1 *ngIf="formOpinions.value.editOpinionId">Editar a opinião <strong>{{formOpinions.value.editOpinionId}}</strong>:</h1>
          </ion-col>
        </ion-row>

        <form name="opinions" [formGroup]="formOpinions" (submit)="showConfirmAlert(formOpinions.value.editOpinionId ? 'editar' : 'criar', formOpinions.value)">
          <ion-row class="grid-content" [ngClass]="{'grid-content-edit': formOpinions.value.editOpinionId }">
            <ion-input type="hidden" formControlName="editOpinionId"></ion-input>
            <ion-col size-md="9" size-sm="12" size-xs="12">
              <ion-item>
                <ion-label position="floating">Título da avaliação da marca</ion-label>
                <ion-input type="text" minlength="4" maxlength="80" formControlName="newOpinionBrandTitle"></ion-input>
              </ion-item>
            </ion-col>

            <ion-col size-md="3" size-sm="12" size-xs="12">
              <ion-item lines="none" color="none">
                <ion-label>Ativo</ion-label>
                <ion-toggle color="primary" [(ngModel)]="activeChecked"  [ngModelOptions]="{standalone: true}"></ion-toggle>
              </ion-item>
            </ion-col>
          </ion-row>

          <ion-row class="grid-content" [ngClass]="{'grid-content-edit': formOpinions.value.editOpinionId }">
            <ion-col size-md="6" size-sm="12" size-xs="12">
              <ion-item>
                <ion-label position="floating">Pontos positivos da marca</ion-label>
                <ion-textarea minlength="4" maxlength="300" rows="3" formControlName="newOpinionBrandPositive"></ion-textarea>
              </ion-item>
            </ion-col>
            <ion-col size-md="6" size-sm="12" size-xs="12">
              <ion-item>
                <ion-label position="floating">Pontos negativos da marca</ion-label>
                <ion-textarea minlength="4" maxlength="300" rows="3" formControlName="newOpinionBrandNegative"></ion-textarea>
              </ion-item>
            </ion-col>
          </ion-row>

          <ion-row class="grid-content" [ngClass]="{'grid-content-edit': formOpinions.value.editOpinionId }">
            <ion-col size-md="12" size-sm="12" size-xs="12">
              <ion-item>
                <ion-label position="floating">Título da avaliação do carro</ion-label>
                <ion-input type="text" minlength="4" maxlength="80" formControlName="newOpinionCarTitle"></ion-input>
              </ion-item>
            </ion-col>
          </ion-row>

          <ion-row class="grid-content" [ngClass]="{'grid-content-edit': formOpinions.value.editOpinionId }">
            <ion-col size-md="6" size-sm="12" size-xs="12">
              <ion-item>
                <ion-label position="floating">Pontos positivos do carro</ion-label>
                <ion-textarea minlength="4" maxlength="300" rows="3" formControlName="newOpinionCarPositive"></ion-textarea>
              </ion-item>
            </ion-col>
            <ion-col size-md="6" size-sm="12" size-xs="12">
              <ion-item>
                <ion-label position="floating">Pontos negativos do carro</ion-label>
                <ion-textarea minlength="4" maxlength="300" rows="3" formControlName="newOpinionCarNegative"></ion-textarea>
              </ion-item>
            </ion-col>
          </ion-row>

          <ion-row class="grid-content" [ngClass]="{'grid-content-edit': formOpinions.value.editOpinionId }">
            <ion-col size-md="3" size-sm="6" size-xs="12" *ngIf="!formOpinions.value.editOpinionId">
              <ion-button size="default" title="Criar" expand="block" color="success" type="submit" [disabled]="formOpinions.status === 'INVALID'">
                <ion-icon name="add-circle-outline" slot="start"></ion-icon>
                <ion-label slot="end">Criar</ion-label>
              </ion-button>
            </ion-col>

            <ion-col size-md="3" size-sm="6" size-xs="12" *ngIf="formOpinions.value.editOpinionId">
              <ion-button size="default" title="Criar" expand="block" color="success" type="submit" [disabled]="formOpinions.status === 'INVALID'">
                <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
                <ion-label slot="end">Salvar</ion-label>
              </ion-button>
            </ion-col>

            <ion-col size-md="3" size-sm="6" size-xs="12" *ngIf="!formOpinions.value.editOpinionId && !formOpinions.pristine">
              <ion-button size="default" title="Limpar" expand="block" color="medium" type="button" (click)="showConfirmAlert('limpar', formOpinions.value)">
                <ion-icon name="backspace-outline" slot="start"></ion-icon>
                <ion-label slot="end">Limpar</ion-label>
              </ion-button>
            </ion-col>

            <ion-col size-md="3" size-sm="6" size-xs="12" *ngIf="formOpinions.value.editOpinionId">
              <ion-button size="default" title="Descartar" expand="block" color="danger" type="button" (click)="showConfirmAlert('descartar', formOpinions.value)">
                <ion-icon name="close-circle-outline" slot="start"></ion-icon>
                <ion-label slot="end">Descartar</ion-label>
              </ion-button>
            </ion-col>
          </ion-row>
        </form>

        <ion-row><ion-col><br></ion-col></ion-row>

        <ion-row>
          <ion-col><h1>Opiniões:</h1></ion-col>
        </ion-row>

        <ion-row *ngIf="!opinions" class="grid-content">
          <ion-col style="text-align: center; margin: 2rem 0">
            <ion-icon name="alert-circle" color="medium" size="large"></ion-icon>
            <br>
            <ion-label color="medium">Não há nada por aqui ainda!</ion-label>
          </ion-col>
        </ion-row>

        <ion-row *ngIf="opinions" class="grid-header">
          <ion-col size-md="3" size-sm="1" size-xs="1"><ion-label>Id</ion-label></ion-col>
          <ion-col size-md="2" size-sm="2" size-xs="2"><ion-label>Marca</ion-label></ion-col>
          <ion-col size-md="2" size-sm="2" size-xs="2"><ion-label>Nome</ion-label></ion-col>
          <ion-col size-md="2" size-sm="2" size-xs="2"><ion-label>Usuário</ion-label></ion-col>
          <ion-col size-md="1" size-sm="1" size-xs="1"><ion-label>Ativo</ion-label></ion-col>
          <ion-col size-md="2" size-sm="4" size-xs="4"><ion-label>Ação</ion-label></ion-col>
        </ion-row>
        <ion-row *ngFor="let opinion of opinions" class="grid-content">
          <ion-col size-md="3" size-sm="1" size-xs="1"><ion-label>{{opinion._id}}</ion-label></ion-col>
          <ion-col size-md="2" size-sm="2" size-xs="2"><ion-label>{{opinion.model?.brand.name}}</ion-label></ion-col>
          <ion-col size-md="2" size-sm="2" size-xs="2"><ion-label>{{opinion.model?.name}}</ion-label></ion-col>
          <ion-col size-md="2" size-sm="2" size-xs="2"><ion-label>{{opinion.customer?.name}}</ion-label></ion-col>
          <ion-col size-md="1" size-sm="1" size-xs="1">
            <ion-icon *ngIf="opinion.active" size="large" color="success" name="checkmark-circle"></ion-icon>
            <ion-icon *ngIf="!opinion.active" size="large" color="danger" name="close-circle"></ion-icon>
          </ion-col>
          <ion-col size-md="1" size-sm="2" size-xs="2">
            <ion-button size="small" title="Editar" expand="block" color="warning" (click)="editOpinion(opinion)">
              <ion-icon name="create-outline"></ion-icon>
            </ion-button>
          </ion-col>
          <ion-col size-md="1" size-sm="2" size-xs="2">
            <ion-button size="small" title="Excluir" expand="block" color="danger" (click)="showConfirmAlert('excluir', opinion)">
              <ion-icon name="trash-outline"></ion-icon>
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>

  </div>

</ion-content>
